<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1">
    <script nonce="{{ csp_nonce() }}" src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script nonce="{{ csp_nonce() }}" src="https://code.jquery.com/jquery-3.6.1.js"></script>
    <script nonce="{{ csp_nonce() }}" src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.2/socket.io.min.js"></script>
    <script nonce="{{ csp_nonce() }}" src="{{ url_for('static', filename='js/header.js') }}"></script>
    <script nonce="{{ csp_nonce() }}" src="{{ url_for('static', filename='js/main.js') }}"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/index.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/login.css') }}">
    <script nonce="{{ csp_nonce() }}" src="https://www.google.com/recaptcha/enterprise.js?render=6LeqXfwpAAAAAIPmzrWm_du3FD_DfQbA2vxLe7S7"></script>
    <script nonce="{{ csp_nonce() }}" src="https://www.google.com/recaptcha/api.js" async defer></script>
    <link rel="icon" type="image/x-icon" href="/static/favicon/favicon_.ico">
    <title>Login & SignUp</title>
</head>
<!--img src="{{ url_for('static', filename='img/noise.png') }}" style="width: 100vw; height: 100vh; position: absolute;" alt=""-->
<body id="bod">
    <div id="dialogue_" class="man contain_menu center" style="position: fixed; top: 0; left: 0; z-index: 1000; display: none; background-color: #ffffff;">
        <div id="dialogue" class="center" align="center" style="transition: .3s; position: absolute; height: 400px; width:auto; height: auto; border-radius: 15px; background-color: rgb(255, 255, 255); border: 1px solid rgb(177, 177, 177); z-index: 50; padding: 55px 25px;">
            <a onclick="op('dialogue', 'dialogue_');" style="padding: 0px 10px; position: absolute; top: 0;  right: 0; color: white;filter: brightness(-100%); cursor: pointer; margin-top: 0px; font-size: 55px;"><img style="width: 35px;" src="{{ url_for('static', filename='img/close.png') }}" alt=""></a>
            <br><br>
            <div class="col">
                <h1 style="font-size: 25px; color: rgb(0, 0, 0); margin-bottom: 25px; margin: 25px;"><i>Either the Email or Password was Incorrect!</i></h1><br>
                <div class="row" style="margin: 0; margin-top: 25px; width: 40%; padding: 0;">
                    <a onclick="op('dialogue', 'dialogue_');" style="margin: auto; padding: 5px 25px; font-size: 19px; text-wrap: nowrap; background: black; color: #ffffff;">try again</a>
                </div>
            </div>
        </div>
        <div onclick="op('dialogue', 'dialogue_');" style="width: 100vw; height: 100vh; background-color: rgb(250, 250, 250);"></div>
    </div>
    <div id="loading_" class="man contain_menu center" style="position: fixed; top: 0; left: 0; z-index: 1000; display: none; background-color: #ffffff87;">
        <div id="loading" class="center" align="center" style="transition: .3s; position: absolute; height: 400px; width:auto; height: auto; border-radius: 15px; background-color: rgba(255, 255, 255, 0); border: 1px solid rgba(177, 177, 177, 0); z-index: 50; padding: 55px 25px;">
            <img class="img1" style="width: 405px; filter:opacity(.4);" src="/static/img/works.gif">
        </div>
        <div style="width: 100vw; height: 100vh; background-color: rgba(250, 250, 250, 0.445);"></div>
    </div>
    <div id="verify_" class="man contain_menu center" style="position: fixed; top: 0; left: 0; z-index: 1000; display: none; background-color: #ffffff87;">
        <div id="verify" class="center" align="center" style="transition: .3s; position: absolute; height: 400px; width:auto; height: auto; border-radius: 15px; background-color: rgba(0, 0, 0, 0.995); border: 1px solid rgba(177, 177, 177, 0); z-index: 50; padding: 25px 45px; flex-direction: column;">
            <p style="color: white;">A verification code was sent to your Email.</p>
            <input id="verification_code" type="text" class="ra" maxlength="8" style="border: 1px solid rgb(149, 149, 149); border-radius: 7px; padding: 8px 25px; color: rgb(255, 255, 255); margin: 0; max-width: 100%;" placeholder="verify code">
            <p id="ver_handle_error" style="color: red;"></p>
            <a onclick="verify_code(document.getElementById('verification_code').value)" class="back-home ra" style="width: 80%; margin: 0; margin-top: 15px; padding: 10px 25px; background-color: white; display: flex; justify-content: center; align-items: center;"><p class="ra" style="color: black; font-size: 18px;">submit</p></a>
        </div>
        <div onclick="op('verify', 'verify_')" style="width: 100vw; height: 100vh; background-color: rgba(250, 250, 250, 0.445);"></div>
    </div>
    <div class="man tide" style="top: 0%; z-index: -1;"></div>
    <div class="ticker-container" style="background-color: rgb(48, 48, 48);">
        <div class="ticker-content" style="width: 10000px; color: rgb(255, 255, 255);" id="ticker">
          <span style="color: transparent;">this is a horizontal texthorizontal texthorizontal text</span>
          <span style="color: transparent;">this is a horizontal texthorizontal texthorizontal text</span>
          <span style="color: transparent;">this is a horizontal texthorizontal texthorizontal text</span>
          <span style="color: transparent;">this is a horizontal texthorizontal texthorizontal text</span>
          <span style="color: transparent;">this is a horizontal texthorizontal texthorizontal text</span>
          <span style="color: transparent;">this is a horizontal texthorizontal texthorizontal text</span>
          <span style="color: transparent;">this is a horizontal texthorizontal texthorizontal text</span>
          <span style="color: transparent;">this is a horizontal texthorizontal texthorizontal text</span>
          <span style="color: transparent;">this is a horizontal texthorizontal texthorizontal text</span>
          <span style="color: transparent;">this is a horizontal texthorizontal texthorizontal text</span>
          <span style="color: transparent;">this is a horizontal texthorizontal texthorizontal text</span>
          <span style="color: transparent;">this is a horizontal texthorizontal texthorizontal text</span>
          <span style="color: transparent;">this is a horizontal texthorizontal texthorizontal text</span>
          <span style="color: transparent;">this is a horizontal texthorizontal texthorizontal text</span>
          <span style="color: transparent;">this is a horizontal texthorizontal texthorizontal text</span>
          <span style="color: transparent;">this is a horizontal texthorizontal texthorizontal text</span>
          <span style="color: transparent;">this is a horizontal texthorizontal texthorizontal text</span>
        </div>
      </div>
    <div style="width: 100vw; left: 0; top: 0; position: absolute; background-color: #0000; height: 50px;">
    </div>
    <!--div class="man v pizzaria n"></div-->
    <div id="menu_" class="man contain_menu" style="position: fixed; top: 0; left: 0; z-index: 1000; display: none; flex-direction: row; background-color: #0000005d; backdrop-filter: blur(10px);">
        <div id="menu" class="menu">
            <a onclick="op()" style="padding: 10px; position: absolute; top: 0;  right: 0; color: white;filter: brightness(-100%); cursor: pointer; margin-top: -20px; font-size: 55px;"><img style="width: 35px;" src="{{ url_for('static', filename='img/close.png') }}" alt=""></a>
            <br><br>
            <div class="column">
            <h4 onclick="window.location = '/home';" class="b_ fb b">Home</h4>
            </div>
            <div class="column">
            <h4 class="pointer b_" onclick="window.location.href = '/product'">SHOP</h4>
            </div>
            <div class="div center" style="margin: 25px 45px; background-color: #ccc;"></div>
            <div class="column">
            <h4>CATEGORIES</h4>
            <ul id="categories_list">

            </ul>
            </div>
            <!--div class="div center" style="margin: 25px; background-color: #ccc; margin-top: 25px;"></div>
            <div class="column">
                <h4 style="font-weight: 300;" onclick="window.location.href = '/cart'" style="font-weight: 1000;" class="b_ pointer">CART<svg style="width: 15px; margin-left:10px; margin-bottom: -2px; height: auto;" class="svg s" xmlns="http://www.w3.org/2000/svg" version="1.1" width="100%" height="100%" viewBox="5.7 0 105.5 126.1" preserveAspectRatio="xMinYMax meet" data-hook="svg-icon-1">
                    <path d="M99.8 28.4c0-1.2-0.9-2-2.1-2h-15c0 3.2 0 7.6 0 8.2 0 1.5-1.2 2.6-2.6 2.9 -1.5 0.3-2.9-0.9-3.2-2.3 0-0.3 0-0.3 0-0.6 0-0.9 0-4.7 0-8.2H40.1c0 3.2 0 7.3 0 8.2 0 1.5-1.2 2.9-2.6 2.9 -1.5 0-2.9-0.9-3.2-2.3 0-0.3 0-0.3 0-0.6 0-0.6 0-5 0-8.2h-15c-1.2 0-2 0.9-2 2L8.3 124c0 1.2 0.9 2.1 2.1 2.1h96.3c1.2 0 2.1-0.9 2.1-2.1L99.8 28.4z" fill="none" stroke="black" stroke-width="5"></path>
                    <path d="M59.1 5.9c-2.9 0-2 0-2.9 0 -2 0-4.4 0.6-6.4 1.5 -3.2 1.5-5.9 4.1-7.6 7.3 -0.9 1.8-1.5 3.5-1.8 5.6 0 0.9-0.3 1.5-0.3 2.3 0 1.2 0 2.1 0 3.2 0 1.5-1.2 2.9-2.6 2.9 -1.5 0-2.9-0.9-3.2-2.3 0-0.3 0-0.3 0-0.6 0-1.2 0-2.3 0-3.5 0-3.2 0.9-6.4 2-9.4 1.2-2.3 2.6-4.7 4.7-6.4 3.2-2.9 6.7-5 11.1-5.9C53.5 0.3 55 0 56.7 0c1.5 0 2.9 0 4.4 0 2.9 0 5.6 0.6 7.9 1.8 2.6 1.2 5 2.6 6.7 4.4 3.2 3.2 5.3 6.7 6.4 11.1 0.3 1.5 0.6 3.2 0.6 4.7 0 1.2 0 2.3 0 3.2 0 1.5-1.2 2.6-2.6 2.9s-2.9-0.9-3.2-2.3c0-0.3 0-0.3 0-0.6 0-1.2 0-2.6 0-3.8 0-2.3-0.6-4.4-1.8-6.4 -1.5-3.2-4.1-5.9-7.3-7.3 -1.8-0.9-3.5-1.8-5.9-1.8C61.1 5.9 59.1 5.9 59.1 5.9L59.1 5.9z" fill="none" stroke="black" stroke-width="5"></path>
                    <text x="58.5" y="77" dy=".35em" text-anchor="middle" style="color: black; font-style: normal;" class="uxskpx" data-hook="items-count"></text>
                </svg>
                  </h4>
                <h4 style="font-weight: 300;" onclick="window.location.href = '/saved'" class="b_ pointer">SAVED<svg style="width: 20px; color: #6e6e6e; margin-left:5px; margin-bottom: -3px; height: auto;" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="100" height="100" viewBox="0 0 32 32" fill="#6e6e6e"><path d="M 7 5 L 7 28 L 8.59375 26.8125 L 16 21.25 L 23.40625 26.8125 L 25 28 L 25 5 Z M 9 7 L 23 7 L 23 24 L 16.59375 19.1875 L 16 18.75 L 15.40625 19.1875 L 9 24 Z"></path></svg></h4>
            </div-->
        </div>
        <div onclick="op()" style="width: 100%; background-color: #0000005d; backdrop-filter: blur(10px);"></div>
    </div>
    <header id="header" class="center">
        <a style="flex:1;" onclick="menu()"><img style="width: 50px;" src="{{ url_for('static', filename='img/barsa.png') }}" alt=""></a>
        <div onclick="window.location = '/home';" class="one logo center" style="flex:1;position: absolute;"><img id="frg" style="cursor: pointer; margin-top: 50px;" src="{{ url_for('static', filename='img/frg.png') }}" alt=""></div>
        <a class="one" align="right" style="flex: 1;">
            <a href="/auth" class="fb b abs"><svg data-bbox="0 0 50 50" class="svg p" data-type="shape" xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 50 50"><g><path d="M25 48.077c-5.924 0-11.31-2.252-15.396-5.921 2.254-5.362 7.492-8.267 15.373-8.267 7.889 0 13.139 3.044 15.408 8.418-4.084 3.659-9.471 5.77-15.385 5.77m.278-35.3c4.927 0 8.611 3.812 8.611 8.878 0 5.21-3.875 9.456-8.611 9.456s-8.611-4.246-8.611-9.456c0-5.066 3.684-8.878 8.611-8.878M25 0C11.193 0 0 11.193 0 25c0 .915.056 1.816.152 2.705.032.295.091.581.133.873.085.589.173 1.176.298 1.751.073.338.169.665.256.997.135.515.273 1.027.439 1.529.114.342.243.675.37 1.01.18.476.369.945.577 1.406.149.331.308.657.472.98.225.446.463.883.714 1.313.182.312.365.619.56.922.272.423.56.832.856 1.237.207.284.41.568.629.841.325.408.671.796 1.02 1.182.22.244.432.494.662.728.405.415.833.801 1.265 1.186.173.154.329.325.507.475l.004-.011A24.886 24.886 0 0 0 25 50a24.881 24.881 0 0 0 16.069-5.861.126.126 0 0 1 .003.01c.172-.144.324-.309.49-.458.442-.392.88-.787 1.293-1.209.228-.232.437-.479.655-.72.352-.389.701-.78 1.028-1.191.218-.272.421-.556.627-.838.297-.405.587-.816.859-1.24a26.104 26.104 0 0 0 1.748-3.216c.208-.461.398-.93.579-1.406.127-.336.256-.669.369-1.012.167-.502.305-1.014.44-1.53.087-.332.183-.659.256-.996.126-.576.214-1.164.299-1.754.042-.292.101-.577.133-.872.095-.89.152-1.791.152-2.707C50 11.193 38.807 0 25 0"></path></g></svg></a>
            <a href="/cart" class="fb b abs"><svg class="svg s" xmlns="http://www.w3.org/2000/svg" version="1.1" width="100%" height="100%" viewBox="5.7 0 105.5 126.1" preserveAspectRatio="xMinYMax meet" data-hook="svg-icon-1"><path d="M99.8 28.4c0-1.2-0.9-2-2.1-2h-15c0 3.2 0 7.6 0 8.2 0 1.5-1.2 2.6-2.6 2.9 -1.5 0.3-2.9-0.9-3.2-2.3 0-0.3 0-0.3 0-0.6 0-0.9 0-4.7 0-8.2H40.1c0 3.2 0 7.3 0 8.2 0 1.5-1.2 2.9-2.6 2.9 -1.5 0-2.9-0.9-3.2-2.3 0-0.3 0-0.3 0-0.6 0-0.6 0-5 0-8.2h-15c-1.2 0-2 0.9-2 2L8.3 124c0 1.2 0.9 2.1 2.1 2.1h96.3c1.2 0 2.1-0.9 2.1-2.1L99.8 28.4z"></path><path d="M59.1 5.9c-2.9 0-2 0-2.9 0 -2 0-4.4 0.6-6.4 1.5 -3.2 1.5-5.9 4.1-7.6 7.3 -0.9 1.8-1.5 3.5-1.8 5.6 0 0.9-0.3 1.5-0.3 2.3 0 1.2 0 2.1 0 3.2 0 1.5-1.2 2.9-2.6 2.9 -1.5 0-2.9-0.9-3.2-2.3 0-0.3 0-0.3 0-0.6 0-1.2 0-2.3 0-3.5 0-3.2 0.9-6.4 2-9.4 1.2-2.3 2.6-4.7 4.7-6.4 3.2-2.9 6.7-5 11.1-5.9C53.5 0.3 55 0 56.7 0c1.5 0 2.9 0 4.4 0 2.9 0 5.6 0.6 7.9 1.8 2.6 1.2 5 2.6 6.7 4.4 3.2 3.2 5.3 6.7 6.4 11.1 0.3 1.5 0.6 3.2 0.6 4.7 0 1.2 0 2.3 0 3.2 0 1.5-1.2 2.6-2.6 2.9s-2.9-0.9-3.2-2.3c0-0.3 0-0.3 0-0.6 0-1.2 0-2.6 0-3.8 0-2.3-0.6-4.4-1.8-6.4 -1.5-3.2-4.1-5.9-7.3-7.3 -1.8-0.9-3.5-1.8-5.9-1.8C61.1 5.9 59.1 5.9 59.1 5.9L59.1 5.9z"></path><text x="58.5" y="77" dy=".35em" text-anchor="middle" style="color: white;" class="uxskpx" data-hook="items-count">0</text></svg></a>
        </a>
    </header>
    <div id="begone">
        <i style="margin-left: 20px; width: auto; color: red; display: flex; position: absolute; z-index: 500; right: 0; flex-direction: column; margin-top: 25px; text-align: right; display: inline-block;" id="errorhandle" class="fp"></i>
    <div class="section center" style="margin: auto; background: none; margin-top: 60px; display: flex; justify-content: center; align-items: center;" id="container">
        <div class="col">
                 <div class="login_register">
                 </div>
    <div class="card active fade-away" id="upcont">
        <h2 class="center"><i style="font-weight: 900; font-style: italic; font-size: 30px;" class="me">SIGNUP</i></h2>
        <div class="form">
            <input type="email" onchange="isvalid(this)" placeholder="Email Adress" id="email" class="emailup">
            <input type="password" onchange="isvalid(this, 'Password', 2)" placeholder="password"  id="pass" class="passup">
            <input type="password" onchange="isvalid(this, 'Password', 2)" placeholder="Confirm Password" id="confirm_pass" class="confirm_pass">
        </div>
<br>
        <a style="margin-left: 10px;font-family: 'cool', sans-serif;" href="#" class="fp">Get Help Registering?</a>
            <a class="back-home" style="width: 80%; display: flex; justify-content: center; align-items: center;" id="signup_"><p>Signup</p></a>
            <div class="row">
                <p style="font-family: 'cool', sans-serif;">Already have an account? </p><a class="login ac fp" style="height: 100%; margin-top: 15px; width: 5%; background-color: transparent;" id="SignIn" target="blank">Login</a>
            </div>
    </div>
    <div class="card" id="incont">
        <h2 class="center"><i style="font-weight: 900; font-style: italic; font-size: 30px;" class="me">login</i></h2>

        <div class="form">
            <input type="email" onchange="isvalid(this)" placeholder="Email Adress" id="emailin" class="emailin">
            <input type="password" onchange="isvalid(this, 'Password')" placeholder="password" id="passin" class="passin">
        </div>
    <br>
        <a style="margin-left: 20px;font-family: 'cool', sans-serif;" href="#" class="fp">Forgot password?</a>
            <a class="back-home" style="width: 80%; display: flex; justify-content: center; align-items: center;" id="signin_"><p>Login</p></a>
            <div class="row">
            <p style="font-family: 'cool', sans-serif;">Don't have an account? </p><a class="register fp" style="height: 100%; margin-top: 15px; width: 5%;" id="SignUp" target="blank">Signup</a>
        </div>
        </div>
</div>
    </div>
    </div>
</body>
</html>
<script nonce="{{ csp_nonce() }}">
    function verify_code(user_code) {
        if (user_code.length == 8)
        verify_code_request(user_code)
        else
        document.getElementById("verification_code").style.outline = "2px solid red";
    }
    var em = false, pe = false, co = false;
    function isvalid(th, key_name="Email") {
        if (key_name == "Email" && !validateEmail(th.value)) {
            document.getElementById('errorhandle').innerHTML += `<div style="display: block;"><div ONLOAD=kill_after(this) class="error_message center only_${key_name}" style="padding:8px 25px; text-wrap: nowrap; flex-direction: row; justify-content: end; display: inline-flex; padding-right: 20px; margin: 8px 0; background: red; color: white; transition: .5s; width: auto;"><i style="text-wrap: wrap;">hmm.. The ${key_name} is not right!</i><img style="padding-left: 40px;width:25px; height: 25px;" onclick="this.parentNode.remove()" src="/static/img/close.png"></div></div>`;
            document.querySelectorAll(`.only_go_${key_name}`).forEach(el => {el.remove()})
            em = false;
            return;
        } if (key_name == "Password" && !(th.value.length >= 8 && th.value.length <= 32) && !validatePassword(th.value)) {
            document.getElementById('errorhandle').innerHTML += `<div style="display: block;"><div ONLOAD=kill_after(this) class="error_message center only_${key_name}" style="padding:8px 25px; text-wrap: nowrap; flex-direction: row; justify-content: end; display: inline-flex; padding-right: 20px; margin: 8px 0; background: red; color: white; transition: .5s; width: auto;"><i style="text-wrap: wrap;">The ${key_name} should contain alphabets only, and should be greater than 8 characters</i><img style="padding-left: 40px;width:25px; height: 25px;" onclick="this.parentNode.remove()" src="/static/img/close.png"></div></div>`;
            document.querySelectorAll(`.only_go_${key_name}`).forEach(el => {el.remove()})
            pe = false;
            return;
        }
        document.querySelectorAll(`.only_${key_name}`).forEach(el => {el.remove()})
        document.getElementById('errorhandle').innerHTML += `<div style="display: flex; justify-content: end;"><div ONLOAD=kill_after(this) class="error_message center only_go_${key_name}" style="padding:8px 25px; text-wrap: nowrap; flex-direction: row; justify-content: center; align-items: center; padding-right: 20px; margin: 8px 0; background: green; color: white; transition: .5s; width: auto; align-items: center; display: flex;"><i style="text-wrap: wrap;" class="center"><svg xmlns="http://www.w3.org/2000/svg" style="width:25px; padding-right: 15px;height: 25px;" x="0px" y="0px" width="100" height="100" viewBox="0 0 48 48">
<path fill="#c8e6c9" d="M36,42H12c-3.314,0-6-2.686-6-6V12c0-3.314,2.686-6,6-6h24c3.314,0,6,2.686,6,6v24C42,39.314,39.314,42,36,42z"></path><path fill="#4caf50" d="M34.585 14.586L21.014 28.172 15.413 22.584 12.587 25.416 21.019 33.828 37.415 17.414z"></path>
</svg>The ${key_name} looks right!</i><img style="padding-left: 40px;width:25px; height: 25px;" onclick="this.parentNode.remove()" src="/static/img/close.png"></div></div>`;
        if (key_name == "Email")
        em = true;
        if (key_name == "Password")
        pe = true;
    }
    function validateEmail(email) {
        const re = /^(([^<>()[\]\.,;:\s@\"]+(\.[^<>()[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i;
        return re.test(String(email).toLowerCase());
    }
    function validatePassword(password) {
        const re_ = /^(?=[a-zA-Z0-9#@$?]{8,}$)(?=.*?[a-z])(?=.*?[A-Z])(?=.*?[0-9]).*/i;
        return re_.test(String(password).toLowerCase());
    }
</script>
<script nonce="{{ csp_nonce() }}">
    function __onClick() {
      grecaptcha.enterprise.ready(async () => {
        const token = await grecaptcha.enterprise.execute('6LeqXfwpAAAAAIPmzrWm_du3FD_DfQbA2vxLe7S7', {action: 'LOGIN'});
      });
    }
    __onClick()
</script>
<script src="https://www.google.com/recaptcha/api.js?onload=onloadCallback&render=explicit"></script>

<script nonce="{{ csp_nonce() }}">
const SignUpButton = document.getElementById("SignUp");
const SignInButton = document.getElementById("SignIn");
const contLogin = document.getElementById("incont");
const contSignup = document.getElementById("upcont");

SignUpButton.addEventListener('click', () => {
    contLogin.classList.remove("active");
    contLogin.classList.add("fade-away");
    setTimeout(function () {
        contSignup.classList.remove("fade-away");
        contSignup.classList.add("active");
    }, 500);
});

SignInButton.addEventListener('click', () => {
    contSignup.classList.remove("active");
    contSignup.classList.add("fade-away");
    setTimeout(function () {
        contLogin.classList.remove("fade-away");
        contLogin.classList.add("active");
    }, 600);
});
</script>
<script nonce="{{ csp_nonce() }}">
    window.onpageshow = function(event) {
      if (event.persisted) {
          window.location.reload();
      }
  };
</script>
<script nonce="{{ csp_nonce() }}">
    function up(v) {
        const value = v;
        var ticker = document.getElementById('ticker');
        ticker.innerHTML = '';
        var a;
        if (value.length> 12)
            a = Math.floor(value.length+5);
        else
            a = Math.floor(value.length+100);
        for (var i = 0; i < a; i++) {
            var span = document.createElement('span');
            span.innerHTML = value; // Set initial text
            ticker.appendChild(span);
        }
    }
</script>
<script nonce="{{ csp_nonce() }}">
    function kill_after(th){
        setTimeout(() => {
            th.style.transform = "translate(200%, 0)";
            setTimeout(() => {
                th.remove();
            }, 500);
        }, 5000);
    }
</script>
    <script nonce="{{ csp_nonce() }}">
    var got = 0;
    var errors = 0
    const loc = window.location.href;
    console.log(loc)
    console.log(getcookie("evid"))
    $(document).ready(function() {
        var token = '{{ token }}';
        var socket = io('https://'+window.location.hostname, {
            extraHeaders: {
                Authorization: '' + token
            }
        });
        socket.on("handleErrors"+getcookie('evid'), function(data) {
            console.log("wnaw awfawlgh a");
            document.getElementById('errorhandle').innerHTML = `<div style="display: flex; justify-content: end;"><div ONLOAD=kill_after(this) class="error_message center only_go_Password" style="padding:8px 25px; text-wrap: nowrap; flex-direction: row; justify-content: center; align-items: center; padding-right: 20px; margin: 8px 0; background: red; color: white; transition: .5s; width: auto; align-items: center; display: flex;"><i style="text-wrap: wrap;" class="center">${data}</i><img style="padding-left: 40px;width:25px; height: 25px;" onclick="this.parentNode.remove()" src="/static/img/close.png"></div></div>`;
            menu("dialogue", "dialogue_");
        });
        console.log("user_"+getcookie('evid'));
        socket.on("user_"+getcookie('evid'), function(data) {
            console.log("done -------------------------");
            if (data) {
                document.getElementById("begone").style.display = "none";
            }
        });
        socket.on("loaduser"+getcookie('evid'), function(data) {
            console.log(data);
            function thru() {
                fetch("https://"+window.location.hostname+'/loadUser/'+data[0], {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                })
                .then(response => response.json())
                .then(data => {
                    console.log(data);
                    if (data[0] === "200") {
                        localStorage.setItem('auth', JSON.stringify(data));
                        window.location.href = "https://"+window.location.hostname+'/auth';
                    } else {
                        window.location.href = "https://"+window.location.hostname+"/500";
                    }
                })
                .catch(error => {
                        console.error('Error:', error);
                    });
                }
                thru();
            });
            socket.on(getcookie('evid')+"r", function(data) {
            if (data[2] != "") {
                for (let v = 0; v< data[0].length;v++) {
                    if (v != 0)
                    document.getElementById("categories_list").innerHTML += `<li onclick="window.location.href = '/products/${data[0][v].category_id}'" class="fb b b_">${data[0][v].name.replace(/ /g, '&nbsp;')}</li>`;
                    else
                    document.getElementById("categories_list").innerHTML = `<li onclick="window.location.href = '/products/${data[0][v].category_id}'" class="fb b b_">${data[0][v].name.replace(/ /g, '&nbsp;')}<i class="tag">NEW</i></li>`;
                }
            }
          });

        socket.on(getcookie('evid'), function(data) {
            if (data['goKaraleva'] == '1') {
                document.querySelectorAll(".uxskpx").forEach(el => {el.innerHTML = `${data['amount']}`});
                got = 1;
                up(data['ticker']);
            }
        });
        function redund() {
            const j = [`${getcookie('evid')}`,''];
            socket.emit("red", `${j}`)
            socket.emit("get_category_read", "alldata_")
            console.log("Retrying...")
        }
        function logi() {
            menu("loading", "loading_");
            const a = document.getElementById('emailin').value;
            const b = document.getElementById('passin').value;
            socket.emit("login", a,b, function (data) {
                op('loading', 'loading_', 0);
            });
        }
        function signu() {
            menu("loading", "loading_");
            const c = document.getElementById('email').value;
            const d = document.getElementById('pass').value;
            socket.emit("sign_verify", c,d, function (data) {
                op('loading', 'loading_', 0);
                if (data[0] == 200)
                menu("verify", "verify_")
                else {
                    document.getElementById('errorhandle').innerHTML += `<div style="display: flex; justify-content: end;"><div ONLOAD=kill_after(this) class="error_message center only_go_Password" style="padding:8px 25px; text-wrap: nowrap; flex-direction: row; justify-content: center; align-items: center; padding-right: 20px; margin: 8px 0; background: red; color: white; transition: .5s; width: auto; align-items: center; display: flex;"><i style="text-wrap: wrap;" class="center">Error: Something Went wrong. :/</i><img style="padding-left: 40px;width:25px; height: 25px;" onclick="this.parentNode.remove()" src="/static/img/close.png"></div></div>`;
                }
            });
        }
        function request_verify(user_code) {
            //op('verify', 'loading_', 0);
            menu("loading", "loading_");
            const c = document.getElementById('email').value;
            const d = document.getElementById('pass').value;
            socket.emit("signup", c,d,user_code, function (data) {
                op('loading', 'loading_', 0);
                if (data[0] == 401) {
                    document.getElementById("ver_handle_error").innerHTML = ("Wrong code! :(");
                } else if (data[0] == 400) {
                    document.getElementById("ver_handle_error").innerHTML = ("Code Expired! :/");
                }
            });
        }
        window.login = logi;
        window.verify_code_request = request_verify;
        window.signup = signu;
        window.redunduncy = redund;
    });
    try {
        var my_interval_variable = setInterval(my_inter,500);
        function my_inter(){
            if (got != 1) {
                redunduncy()
                clearInterval(my_interval_variable)
            }
        }
    } catch (err) {
        console.log(err);
    }

    document.getElementById('signin_').addEventListener('click' , function () {
        if (em == true && pe == true)
        login();
    });
    document.getElementById('signup_').addEventListener('click' , function () {
        if (em == true && pe == true)
        signup();
    });
    </script>
    <script nonce="{{ csp_nonce() }}">
        function TextAbstract(text, length) {
            if (text.length > length) {
                return text.substring(0, length - 3) + '...';
            }
            return text;
    }

</script> 
